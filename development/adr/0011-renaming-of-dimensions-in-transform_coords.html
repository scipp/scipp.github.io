
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ADR 0011: Renaming of Dimensions in transform_coords &#8212; Scipp</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=6867b9c9"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'development/adr/0011-renaming-of-dimensions-in-transform_coords';</script>
    <script src="../../_static/anaconda-icon.js?v=461bdc62"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ADR 0012: Rebin should apply irreducible masks" href="0012-rebin-should-apply-irreducible-masks.html" />
    <link rel="prev" title="ADR 0010: Acknowledge stability and maintainability tasks" href="0010-acknowledge-stability-and-maintainability-tasks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="25.12.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-2022.svg" class="logo__image only-light" alt="Scipp - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="Scipp - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about/index.html">
    About
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippnexus">
    Scippnexus
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippneutron">
    Scippneutron
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/ess">
    Ess
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/scipp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/scipp/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/scipp/scipp" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippnexus">
    Scippnexus
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippneutron">
    Scippneutron
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/ess">
    Ess
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/scipp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/scipp/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/scipp/scipp" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coding-conventions.html">Coding conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook-style-guide.html">Jupyter Notebook Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tooling.html">Tooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasing-scipp.html">Releasing Scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../architecture-decision-records.html">Architecture Decision Records</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0001-remove-dataset-masking-support.html">ADR 0001: Remove dataset masking support</a></li>
<li class="toctree-l2"><a class="reference internal" href="0002-remove-instrument-view-projection-options.html">ADR 0002: Remove instrument view 2D projection options</a></li>
<li class="toctree-l2"><a class="reference internal" href="0003-refactor-plotting-code-with-mvc-pattern.html">ADR 0003: Refactor plotting code to use Model-View-Controller design pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="0004-use-ipympl-backend-for-matplotlib.html">ADR 0004: Use the ipympl backend for Matplotlib figures in Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="0005-remove-need-for-bins-property-when-calling-bin-or-histogram.html">ADR 0005: Remove need for <code class="docutils literal notranslate"><span class="pre">bins</span></code> property when calling <code class="docutils literal notranslate"><span class="pre">bin</span></code> or <code class="docutils literal notranslate"><span class="pre">histogram</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="0006-add-readonly-flags.html">ADR 0006: Add read-only flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="0007-do-not-support-args-referencing-x-or-y.html">ADR 0007: Do not support arguments referring to <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="0008-consistent-multi-dimensional-coords.html">ADR 0008: Consistent multi-dimensional coords</a></li>
<li class="toctree-l2"><a class="reference internal" href="0009-handle-dimensionless-as-non-counts.html">ADR 0009: Handle dimensionless as non-counts</a></li>
<li class="toctree-l2"><a class="reference internal" href="0010-acknowledge-stability-and-maintainability-tasks.html">ADR 0010: Acknowledge stability and maintainability tasks</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">ADR 0011: Renaming of Dimensions in <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="0012-rebin-should-apply-irreducible-masks.html">ADR 0012: Rebin should apply irreducible masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="0013-plot-should-not-resample-automatically.html">ADR 0013: Plot should not resample automatically</a></li>
<li class="toctree-l2"><a class="reference internal" href="0014-switch-calendar-versioning.html">ADR 0014: Switch to Calendar Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="0015-disable-support-for-broadcasting-variances.html">ADR 0015: Disable support for broadcasting variances</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-do-not-support-attrs.html">ADR 0016: Do not support “attrs”</a></li>
<li class="toctree-l2"><a class="reference internal" href="0017-restrict-dataset-to-items-with-matching-dimensionality.html">ADR 0017: Restrict Dataset to items with matching dimensionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="0018-bin-hist-reduction-dims.html">ADR 0018: More explicit control of replaced dims in <code class="docutils literal notranslate"><span class="pre">bin</span></code> and <code class="docutils literal notranslate"><span class="pre">hist</span></code> functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="0019-binned-data-unit-dtype-python-properties.html">ADR 0019: Binned data <code class="docutils literal notranslate"><span class="pre">unit</span></code> and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> properties should return element unit and dtype.</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../internals/index.html">Internals</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../internals/concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/constructing_variables.html">C++ API for constructing variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/customizing.html">Customizing Scipp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/multi_dimensional_indexing.html">Multi-Dimensional Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/transform.html">Transforming data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/variable_implementation.html">Implementation of class Variable</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constraints">Constraints</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#commutability-with-slicing-and-concatenating">Commutability with slicing and concatenating</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-implementation-v0-8-v0-10">Existing Implementation (v0.8 - v0.10)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#split-join">Split-Join</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cycles">Cycles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternatives">Alternatives</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-coloring">Global Coloring</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contracting-cycles">Contracting Cycles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision">Decision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consequences">Consequences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#positive">Positive:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#negative">Negative:</a></li>
</ul>
</li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/development/adr/0011-renaming-of-dimensions-in-transform_coords.rst"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Development</a></li>
    
    
    <li class="breadcrumb-item"><a href="../architecture-decision-records.html" class="nav-link">Architecture Decision Records</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">ADR 0011: Renaming of Dimensions in <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code></span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="adr-0011-renaming-of-dimensions-in-transform-coords">
<h1>ADR 0011: Renaming of Dimensions in <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code><a class="headerlink" href="#adr-0011-renaming-of-dimensions-in-transform-coords" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Status: accepted</p></li>
<li><p>Deciders: Jan-Lukas, Neil, Simon</p></li>
<li><p>Date: 2021-12-15</p></li>
</ul>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../../generated/functions/scipp.transform_coords.html#scipp.transform_coords" title="scipp.transform_coords"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipp.transform_coords()</span></code></a> computes new coordinates from other coordinates and attributes.
This is often used to express conversions of dimension-coordinates to a single output such as <code class="docutils literal notranslate"><span class="pre">datetime</span></code> to <code class="docutils literal notranslate"><span class="pre">local_time</span></code> in the user guide or <code class="docutils literal notranslate"><span class="pre">tof</span></code> to <code class="docutils literal notranslate"><span class="pre">wavelength</span></code> in Scippneutron.
As those represent changes of coordinate systems, it makes sense to change the names of dimensions as well.</p>
<p>Since <a class="reference internal" href="../../generated/functions/scipp.transform_coords.html#scipp.transform_coords" title="scipp.transform_coords"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipp.transform_coords()</span></code></a> is a general purpose function, it cannot make assumptions about the meaning of coordinates.
Any algorithm that determines how dimensions are renamed must therefore be based solely on the input data (<code class="docutils literal notranslate"><span class="pre">DataArray</span></code> / <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> and <code class="docutils literal notranslate"><span class="pre">graph</span></code>).
It must furthermore not depend on the order the graph is traversed in, as that order is an implementation detail.
When there is more than one possible choice how dimensions can be renamed, it is better to not rename at all and leave it up to the user’s judgment.</p>
<p>Transformations are encoded as directed acyclic graphs.
Associating outputs with dimensions can be expressed in terms of coloring those graphs.
Each dimension has a unique color and nodes (coordinates) associated with that dimension (dimension-coordinates) are painted in that color.</p>
<section id="constraints">
<h3>Constraints<a class="headerlink" href="#constraints" title="Link to this heading">#</a></h3>
<section id="commutability-with-slicing-and-concatenating">
<h4>Commutability with slicing and concatenating<a class="headerlink" href="#commutability-with-slicing-and-concatenating" title="Link to this heading">#</a></h4>
<p>It would be desirable to handle dimension renaming in such a way that slicing the data in a dimension, transforming coordinates of each slice, and finally concatenating the slices produces the same result as transforming the original coordinates.
This would allow distributing slices over multiple nodes or performing specialized computations on each slice.
It is not possible, however.</p>
<p>Consider the following graph.
In this section and only this section, <code class="docutils literal notranslate"><span class="pre">x[x,y]</span></code> denotes a coordinate with name <code class="docutils literal notranslate"><span class="pre">x</span></code> and dimensions <code class="docutils literal notranslate"><span class="pre">[x,y]</span></code>.
In the first case (left), the coordinate transformation is performed on the original coordinates.
The resulting <code class="docutils literal notranslate"><span class="pre">c</span></code> has dimensions <code class="docutils literal notranslate"><span class="pre">[a,x,b]</span></code> because it depends on two dimension-coordinates and we cannot automatically determine a single dimension to rename.
On the right, the input data is first sliced in dimension <code class="docutils literal notranslate"><span class="pre">[a]</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> is computed on every slice.
Here, <code class="docutils literal notranslate"><span class="pre">b</span></code> is the only dimension-coordinate in the inputs and dimension <code class="docutils literal notranslate"><span class="pre">[b]</span></code> is therefore renamed to <code class="docutils literal notranslate"><span class="pre">[c]</span></code>.
When we finally concatenate the transformed slices, <code class="docutils literal notranslate"><span class="pre">c</span></code> has dimensions <code class="docutils literal notranslate"><span class="pre">[a,x,c]</span></code> which differ from the result in the left graph.</p>
<a class="reference internal image-reference" href="../../_images/slice-transform-concat.svg"><img alt="slice-transform-concat" src="../../_images/slice-transform-concat.svg" style="width: 640px;" />
</a>
</section>
</section>
<section id="existing-implementation-v0-8-v0-10">
<span id="sec-existing-implementation"></span><h3>Existing Implementation (v0.8 - v0.10)<a class="headerlink" href="#existing-implementation-v0-8-v0-10" title="Link to this heading">#</a></h3>
<p>The implementation in Scipp versions 0.8 - 0.10 (before this ADR) takes only a single node and its direct children into account when determining if a dimension can be renamed through the edges between those nodes.
This approach is quite simple and works well for many cases.
But it has some shortcomings.</p>
<section id="split-join">
<h4>Split-Join<a class="headerlink" href="#split-join" title="Link to this heading">#</a></h4>
<p>In graph 1 below, <code class="docutils literal notranslate"><span class="pre">c</span></code> has two colored (dimension-coordinate) parents which means that neither dimension can be renamed.
However, when an extra node <code class="docutils literal notranslate"><span class="pre">e</span></code> is inserted (graph 2), <code class="docutils literal notranslate"><span class="pre">c</span></code> has only a single colored parent.
Dimension <code class="docutils literal notranslate"><span class="pre">a</span></code> is therefore renamed to <code class="docutils literal notranslate"><span class="pre">e</span></code>.
This is undesirable because the distance between a node and dimension coordinates should not matter, <code class="docutils literal notranslate"><span class="pre">b</span></code> is an ancestor of <code class="docutils literal notranslate"><span class="pre">c</span></code> in both cases.</p>
<a class="reference internal image-reference" href="../../_images/split-join.svg"><img alt="split-join graph" src="../../_images/split-join.svg" style="width: 360px;" />
</a>
</section>
<section id="cycles">
<h4>Cycles<a class="headerlink" href="#cycles" title="Link to this heading">#</a></h4>
<p>All graphs used by <a class="reference internal" href="../../generated/functions/scipp.transform_coords.html#scipp.transform_coords" title="scipp.transform_coords"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipp.transform_coords()</span></code></a> must be directed and acyclic in order to ensure that all inputs to a node are available before processing that node.
This does, however, allow for undirected cycles.
An example of which is given below.
Node <code class="docutils literal notranslate"><span class="pre">d</span></code> can be uniquely associated with <code class="docutils literal notranslate"><span class="pre">a</span></code> in this case.
This would allow renaming dimension <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">d</span></code>.
The purely local rule in versions 0.8 - 0.10 does not, however, rename as it treats the <code class="docutils literal notranslate"><span class="pre">{a,b,c}</span></code> and <code class="docutils literal notranslate"><span class="pre">{b,c,d}</span></code> subgraphs separately.</p>
<a class="reference internal image-reference" href="../../_images/cycle.svg"><img alt="cycle graph" src="../../_images/cycle.svg" style="width: 100px;" />
</a>
</section>
</section>
</section>
<section id="alternatives">
<h2>Alternatives<a class="headerlink" href="#alternatives" title="Link to this heading">#</a></h2>
<section id="global-coloring">
<span id="sec-global-coloring"></span><h3>Global Coloring<a class="headerlink" href="#global-coloring" title="Link to this heading">#</a></h3>
<p>Cycles can be handled by taking the whole graph into account when coloring nodes.
At a high level the corresponding algorithm is</p>
<ol class="arabic simple">
<li><p>For each dimension-coordinate, color all nodes that depend on this coordinate (transitively) with the corresponding color.
Allow multiple colors per node.</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">N</span></code> be the set of all output nodes.</p></li>
<li><p>Remove all nodes with more than one color and all nodes that share a color with other nodes from <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p>Add all parents of the removed nodes in 3. to <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p>Repeat 3-5 until there are no parents left or no nodes are removed in step 3.</p></li>
<li><p>The remaining nodes in <code class="docutils literal notranslate"><span class="pre">N</span></code> are the new dimension-coordinates for their corresponding color.</p></li>
</ol>
<p>This approach renames <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">d</span></code> in the cycle graph in section <a class="reference internal" href="#sec-existing-implementation"><span class="std std-ref">Existing Implementation (v0.8 - v0.10)</span></a>.
But it does not rename <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">c</span></code> in the other two graphs of that section, because <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code>, and <code class="docutils literal notranslate"><span class="pre">e</span></code> all get colored orange, since they depend on <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
</section>
<section id="contracting-cycles">
<h3>Contracting Cycles<a class="headerlink" href="#contracting-cycles" title="Link to this heading">#</a></h3>
<p>Cycles can also be handled by contracting and thereby removing them from the graph.
The following graphs illustrate the procedure.</p>
<p>In graph 1, there is initially one cycle, <code class="docutils literal notranslate"><span class="pre">{c,</span> <span class="pre">e,</span> <span class="pre">f,</span> <span class="pre">h}</span></code>.
It is contracted in the first step, producing a new graph with node <code class="docutils literal notranslate"><span class="pre">Cef</span></code>.
Importantly, inputs and outputs to cycles are preserved.
Inputs and outputs are nodes that only have outgoing or incoming edges in the cycle, respectively.
Edges outside the cycle do not matter.
In graph 1, <code class="docutils literal notranslate"><span class="pre">c</span></code> is the only input and <code class="docutils literal notranslate"><span class="pre">h</span></code> the only output to the cycle.
After contracting, nodes are colored according to similar rules as in the current implementation but adjusted to fix the split-join issue.
In this case, <code class="docutils literal notranslate"><span class="pre">a</span></code> is the only dimension-coordinate and dimension <code class="docutils literal notranslate"><span class="pre">a</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">h</span></code>.</p>
<p>In graph 2, there are three cycles, <code class="docutils literal notranslate"><span class="pre">{c,</span> <span class="pre">e,</span> <span class="pre">f,</span> <span class="pre">h}</span></code>, <code class="docutils literal notranslate"><span class="pre">{b,</span> <span class="pre">c,</span> <span class="pre">f}</span></code>, <code class="docutils literal notranslate"><span class="pre">{b,</span> <span class="pre">c,</span> <span class="pre">e,</span> <span class="pre">f,</span> <span class="pre">h}</span></code>.
We need to choose one to contract.
Different choices produce different final graphs, but those graphs are all equivalent.
Here, we choose <code class="docutils literal notranslate"><span class="pre">{b,</span> <span class="pre">c,</span> <span class="pre">f}</span></code> and contract it.
Note that <code class="docutils literal notranslate"><span class="pre">c</span></code> is the only inner node of the cycle.
But the contraction still produces a new node and crucially removes the <code class="docutils literal notranslate"><span class="pre">(b,</span> <span class="pre">f)</span></code> edge.
Next, the last remaining cycle, <code class="docutils literal notranslate"><span class="pre">{Cc,</span> <span class="pre">e,</span> <span class="pre">f,</span> <span class="pre">h}</span></code>, is contracted as in graph 1.
Finally, the graph is colored in.
Now, for exposition, both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> are dimension-coordinates.
This means that neither <code class="docutils literal notranslate"><span class="pre">Cef</span></code> nor <code class="docutils literal notranslate"><span class="pre">h</span></code> can be colored.
Therefore, dimension <code class="docutils literal notranslate"><span class="pre">d</span></code> is not renamed.
<code class="docutils literal notranslate"><span class="pre">a</span></code> could in principle be renamed to <code class="docutils literal notranslate"><span class="pre">c</span></code> but <code class="docutils literal notranslate"><span class="pre">c</span></code> is excluded from renaming because it is in a cycle.
(It does not matter that the cycle contains only a single node. In general, cycles represent multiple nodes and do not represent dimensions that can be renamed.)</p>
<a class="reference internal image-reference" href="../../_images/cycle-contraction.svg"><img alt="cycle graph" src="../../_images/cycle-contraction.svg" style="width: 640px;" />
</a>
<p>While this algorithm works as desired, it is fairly complicated.</p>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">#</a></h2>
<p>Similarly to <a class="reference internal" href="#sec-global-coloring"><span class="std std-ref">Global Coloring</span></a>, color all nodes that (transitively) depend on a dimension-coordinate with the corresponding color.
Nodes can have multiple colors and keep track of the ‘amount’ of each color as illustrated by the graphs below.</p>
<ol class="arabic simple">
<li><p>The inputs <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are dimension-coordinates and are assigned ‘pure’ colors.
That is, <code class="docutils literal notranslate"><span class="pre">a</span></code> has 1 blue (its own color) and 0 orange (<code class="docutils literal notranslate"><span class="pre">b</span></code>’s color) and <code class="docutils literal notranslate"><span class="pre">b</span></code> is the other way around.
<code class="docutils literal notranslate"><span class="pre">a</span></code> has a single child, <code class="docutils literal notranslate"><span class="pre">c</span></code>, and propagates its color fully.
But <code class="docutils literal notranslate"><span class="pre">b</span></code> has two children and only propagates half of its color to each.
<code class="docutils literal notranslate"><span class="pre">c</span></code> therefore is fully blue and only partially orange and as a result is painted blue.
<code class="docutils literal notranslate"><span class="pre">d</span></code> has only a partial color and thus remains black.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code> propagates its colors to <code class="docutils literal notranslate"><span class="pre">c</span></code>.
And the end result in this case is the same as in 1.
The disparity between those two cases of the original algorithm is thus fixed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code> propagates half of its color to <code class="docutils literal notranslate"><span class="pre">e</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code> which in turn combine their colors in <code class="docutils literal notranslate"><span class="pre">h</span></code>.
As a result, <code class="docutils literal notranslate"><span class="pre">h</span></code> has a full contribution from blue, that is dimension <code class="docutils literal notranslate"><span class="pre">a</span></code>, and <code class="docutils literal notranslate"><span class="pre">a</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">h</span></code>.</p></li>
<li><p>In this case, <code class="docutils literal notranslate"><span class="pre">a</span></code>’s color is divided twice, once at <code class="docutils literal notranslate"><span class="pre">a</span></code> itself and once at <code class="docutils literal notranslate"><span class="pre">c</span></code>.
As a result, most nodes have a fractional color and can therefore not be associated with dimension <code class="docutils literal notranslate"><span class="pre">a</span></code>.
The final node, <code class="docutils literal notranslate"><span class="pre">h</span></code> receives full contributions from both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code>, meaning that those colors cancel.</p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/fractional-colors.svg"><img alt="cycle graph" src="../../_images/fractional-colors.svg" style="width: 640px;" />
</a>
<p>In summary, every node propagates all its colors to all its children.
In the case of multiple children, the color is divided among them evenly resulting in fractional colors.
Colors from all parents of a node are added up.
Only nodes that have a 1, i.e. full contribution of one and only one color can participate in renaming.
Rename each dimension to the coordinate name that satisfies this criterion and is the farthest removed from the input.</p>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Link to this heading">#</a></h2>
<section id="positive">
<h3>Positive:<a class="headerlink" href="#positive" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Automated renaming of dimensions that should always do ‘the right thing’ or nothing.</p></li>
<li><p>Dimension renaming can happen through undirected cycles.</p></li>
<li><p>Split-join type graphs are handled consistently, distances between nodes nodes not matter.</p></li>
<li><p>Simpler to implement than the alternative of contracting cycles.</p></li>
</ul>
</section>
<section id="negative">
<h3>Negative:<a class="headerlink" href="#negative" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>More complicated than the existing algorithm.</p></li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="0010-acknowledge-stability-and-maintainability-tasks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">ADR 0010: Acknowledge stability and maintainability tasks</p>
      </div>
    </a>
    <a class="right-next"
       href="0012-rebin-should-apply-irreducible-masks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ADR 0012: Rebin should apply irreducible masks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024 Scipp contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
Current Scipp version: 25.12.0 (<a href="https://github.com/scipp/Scipp/releases">older versions</a>).</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>